# 熙攘市场今何在 ~ Immemorial Marketeers/Bustling Marketplace

# 不是很难的题。

C！

### a

#4 不带修改，可以看作平凡的二维数点。

#5 和 #6 是十字架结构，讨论后的二维数点。

#1~8 似乎是足够优化的暴力与性质。

然后不难发现问题是矩形数量可以很多，直接跑出来的二维数点很难蚌。

看这个时空限制，猜测可以想点根号科技。

对于 $d \le \sqrt w$，能暴力搞出矩形，这样总量还在 $n\sqrt w$ 级别。

对于 $d>\sqrt w$，却并没有什么有利性质，这样数量和范围都仍然很大。

这样划分显然不是很科学。

讨论方向吧，往右来看。

>  $(l,r) \to (l+d,r+d)$，同时两头等差数列递增到 $t=r-l+1$。
>
> 这是个区间修改，但是等差数列。
>
> 不难算出最多会被分出的三段。
>
> 做查分进行修改：左段区间加 1，中段整体加 0 则不变，右段整体加 -1。
>
> 每个矩形 $(x_1,y_1,x_2,y_2)$ 放到 $y_1-1$ 和 $y_2$ 两处，然后每一处扫描运用线段树。
>
> 然后会发现我们每次查询单点，所以不用线段树，可以树状数组（大喜）。
>
> 我是弱智，我们要查的是单点，但是我们差分两次，所以要是前缀的前缀……

扫描线好题（大乐）。

这样把每一种矩形都拆开，最后询问离线下来分开各做一次。

1024MB 的空间和 7s 时限在这呢。

但是斜着的怎么办？需要区间平移。

已经不是线段树那么一回事儿了，这个东西怕不是 splay……

我**（语塞）。

#5 #6 的性质过大样例了！

接下来是写暴力，还是写平衡树？

感觉平衡树也很怪，暴力吧。

### b

平均数？ dp 吧，状态应该是和当前平均数及数量有关。

然后一个问题是平均数不一定为整数，这个显然不是很好弄状态。

先从其他方向逼近。

最后选出来分成两种，需要的和不需要的（废话）。

希望 up 的尽量多，则在总量确定的情况下，down 的尽量小。

怎么说呢，一个想法是枚举这个大小，然后二分这样能做到的 up 数量。

知道 up 和 down，check 怎么做？

down 显然无脑取最小，然后就可以从左往右扫描 up 区间，然后存在即可以。

时间 $\mathcal{O}(n^2\lg n)$，过掉 50pts 也可以。

14:56，Get！

我们观察一下复杂度瓶颈，不难发现问题在于枚举，因为 check 是 $\mathcal{O}(n)$ 的跑不脱。

能不能直接两重二分？~~从隔壁 wqs 板题走过来的神经病。~~

外层二分 up，少的 up 达不到多的 up 也死。

内层二分 down，多的 down 不行少的 down 也不行。

试试？啊过了？会不会样例太水了？

怀着诡异的心情，开始打牌。发现挂了，~~$\mathcal{O}(n^2\lg n)$ 那份挂了……~~看错了第二份挂了。

但是观察数据的时候发现了另外一条路。

我们要找的是一个 $x$ 满足 $\frac {sum_{x+u-1}-sum_x+sum_u}{d+u}<arr_x$。

然后拆掉发现这个：$sum_{x+u-1}-sum_x-(d+u)arr_x<-sum_d$。

然后想要找这个 $x$ 然后阿巴阿吧不如先去修一下两层二分。

然后发现内层没有单调性，寄。

### 熙攘市场今何在 ~ Immemorial Marketeers

~~锤子不看。~~

怪异的计数问题，首先要想办法解决字典序如何取得。

贪心一波：第一个卖最贵的；第二个在第一个基础上能卖多贵买多贵，一个都不行就最贵；第三个考虑前俩……这样暴力做来是 $\mathcal{O}(n^2)$ 的。

然后计数……也不好弄。

### 熙攘市场今何在 ~ Bustling Marketplace

~~锤子不看。~~

最多重复两轮与 $a_i \to b_i$ 连边。

~~然后怀疑 wlll 爆冲。~~暂时不想。