### 考场记事

等那个倒霉孩子来了就坐那个位置.jpg（14:15）

3,2,1,go! 3,2,1,break!（15:50）

### 考场吐槽

该不会我这场发挥完前1h就成罚坐3h了吧……

《这套题的难度跨度是否有点太大.jpg》

:upside_down_face:

## 思路

**14:15~14:24** 看题，然后傻掉。

按序来，我们看T1。

---

### T1 game

---

**14:25**

观察到联通图是一个很强的限制，这张图上必定会在剩下 $n-1$ 条边的时候达到最终形态，此时谁动手谁就会输掉。

让咱们看看样例是怎么回事……？

哎！我CNM啊！！小样例只有 $k=1$？脸呢？？？

但是看着大的那一个我们不难发现还是可以得出结论，这道题非常水，只需要找到第 $m-n+2$ 个人是哪个势力的就可以直接出答案，连图都用不到。

**14:33**

通过所有样例。

---

### T2 manage

---

**14:33**

注意到 $k$ 在变化，这……

注意到元素之间没有差别，经典啊xdm。

考虑我们一开始对其排序，让这些元素按照出现顺序进行映射。

那么任何一个 $>k$ 的元素都需要另找地方放入，这是需要我们来看的。

那这不行啊，性质不够，我们没有办法得到答案啊！

回忆起廊桥分配，其实很像，我们应该思考有没有办法一块儿统计答案。

仔细想发现连续的一段没有用，可以先跑去重。

去重之后题目就好搞一些，我们考虑只维护最新的 $k$ 个元素。

如果一个元素的前面 $k$ 个内存在相同元素，那么这个元素无需插入，否则需要。

那么查找前面的相同元素即可，之后只需要BIT维护贡献。

最近的相同元素如何查找？直接开桶解决啊！Over。

**14:56**

发现问题，注意到前面 $k$ 个元素不一定会占满 $k$ 的空间。

那么我们实质上应该计算在这段内的空间，这个东西怎么计算？

第一反应是主席树，但是我觉得有点大材小用。

所以这就是我决定再来一个BIT的理由！

我们认为最后一次出现的元素有 $1$ 的权值，其它都没有，这样我们就可以统计了！

那么本题再次得到解决。（这个再次是什么东西啊……）

**15:09**

通过所有样例（没有 `fc` 我也不知道了，但是看上去没有任何问题）。

---

### T3 jumpgo

---

**15:10**

好白浅，告诉我这题怎么做吧~（拖走）

又是我最烦的计数题，就算有个白浅当看板娘（？）也不可能让我回心转意。

还有啊，你觉得无所谓，但是我很有所谓啊！

再让我看到一次 `?` 我就……算了。

考虑到 $n$ 的范围是极小的……

首先我们往 $n^3$ 上靠嘛，这显然是没问题的。

我们还可以借助Sub3和Sub4的部分分来推敲一下计算的方法，没准这俩是提示呢。

考虑到跳棋的规则，我们只有两个两个棋子打包移动。

直接看到Sub4，如果这一段有奇数个，那么答案很明了，我们要么往左，要么往右。

但当这一段有偶数个，此时往左和往右都是有可能的！

所以在有偶数个的时候需要枚举从哪里断开，综上得到 $\mathcal{O}(n)$ 的Sub4算法。

借此我们能否推敲正解？因为Sub4的时间复杂度非常之低。

发现枚举是走不通的，尤其是在Sub5中段数不固定，Sub4的做法需要递归枚举了，肯定有问题。

而且Sub4没有考虑 `?`，这显然是不行的，我们还需要更换方案求解Sub5。

`?` 真的很棘手，我们考虑计数要么直接做要么DP，这道题就考虑DP吧。

设 $dp_{i,j}$ 表示前 $i$ 个中第 $i$ 个为 $j$ 的方案数？这是一种设法。

此时我们只考虑往左走的情况，那么可以通过枚举确定上一个棋子的位置。

思维跳脱开了，刚刚想到有 $a$ 组可以跳 $b$ 次的方案去了。

这个东西发现是一层一层的数列，叠上去的。

仔细想发现是前缀和，于是可以处理出答案。

等等！

题目中说了只要跳法不同就是不同的局面！

那么，如果不考虑 `?` 的存在，我们就可以对每一段进行计算！

感觉好乱，但是还是没能搞清楚 `?` 啊……

**15:57**

很想弄懂 `?`，感觉这东西卡在这里完全没法做。

思考Sub3，Sub3正好是 `?` 专题。

```
7
?100?10
0100010 -> 1
0100110 -> 5
1100010 -> 5
1100110 -> 10
=======
1100110
1100011
0110110
0110011
0011110
0011011
0001111 !
1101100 !
0111100 !
1111000 !
注意后面四种！
```

拉了个样例2，看到这东西了。

一瞬间，我头都大了一圈。

本来打算打个暴力尝试找找规律，发现暴力不会，原因是跳跃的方法找不完。

要知道，我们跳跃的顺序的变化不会出现新的局面，也就是做操作1和2和做操作2和1没有区别。

这就是让我所困扰的，这怎么搞？难度跨度有点大了哈。

跳跃不能爆搜啊，这就让人很头大了啊……

但是换种思路！我们发现如果在不断移动的过程当中遇到了一个单独的 `1`？

发现这东西会去掉一种方案，除此之外没有影响。

这东西代表了上面奇数段剩下的一枚棋子的处理方法，这样我们可以把所有棋子聚到一起。

**17:33**

最后打算打Sub4，发现之前的分析有点问题。

我们实际上是求解一个东西：$n$ 个元素的非升序列的方案数。

那么这个东西怎么求解？

其实是若干个非降路径计数。

那么这个问题迎刃而解，Sub4最终的时间复杂度增到了 $\mathcal{O}(n^2)$。

---

### T4 voidtree

---

**15:37**

先思考一轮，要雨露均沾。

整了一下“样例”（这是真阴间），搞清楚了虚树上的边权怎么搞的了。

那其实这道题有点像询问点距离和的感觉。

给出的是一个排列，这里面有什么性质呢？

最后两题的暴力分也很低，一时半会儿拿不出什么好的算法，需要先分析一下。

**16:33**

感觉T3无望了，暴力都打不出来。

其实认真讲T4的暴力我也打不出来，崩盘了xdm。

**17:04**

睡了个好觉啊……

哥，有没有想过……叶子节点？

woc！叶子节点！

我们只要把叶子节点选齐了就必定是最大值！

那么，我们选不齐的时候只需要选择最大的那若干个！

也就是说，我们可以确定一个LCA，这就是根，然后计算出根到每个叶子节点的路径权值，从中选取若干个最大的，选完最大的再把同子树的那些的贡献清理一下。

如此得到时间复杂度 $\mathcal{O}(nQk)$ 的暴力，拿到前4个点是可以的。

如果我们直接建出虚树，那么建虚树的过程中我们可以顺带处理某些东西，这样不难搞到 $\mathcal{O}(nQ \log n)$ 的时间复杂度，更加优秀。（准确来说是能够多过两个点。）

进一步考虑我们就需要去掉虚树，毕竟建虚树还是太垃圾了。

发现直接在原树上搞也是行得通的，甚至直接能够搞出答案，所以问题来到找到区间形成的虚树的根。

那感情好啊，RMQ咱们熟啊，这不是乱搞。

然后发现这就结了，但是有很多细节是很模糊的，到最后发现是错的。

不过终归是拿到20pts，觉得还是很不甘心，后两题只有20pts。

不对，准确来说时间已经不够了，20pts都拿不到。

整挺好，无所谓了。
